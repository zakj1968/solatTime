<!DOCTYPE html>
<html>
<head>
<style>
body {
  background-color: lightblue;
  color: red;
}
table, th, td {
  border: 1px solid black;
  text-align: left;
}
table {
  width: 50%;
  border-collapse: collapse;
}
th {
  background-color: #4CAF50;
  color: white;
}
tr:nth-child(even) {background-color: #f2f2f2;}
</style>
<SCRIPT LANGUAGE="JavaScript">

const webSocketConn = new WebSocket("ws://192.168.4.1:81");
var readyState = webSocketConn.readyState;
//if connection is open, to keep it alive
if (readyState === 1){ 
	setTimeout(heartbeat,500);
}

function init()
{ 
	webSocketConn.onerror = function(evt) { onError(evt) };
	webSocketConn.onopen = function(evt){onOpen(evt)};
	webSocketConn.onmessage = function(evt){onMessage(evt)};
}
function getFormVal(){
	 var ssid_Val = document.getElementById("ssid").value;
	 var pw_Val = document.getElementById("pass").value;
	 var zone_Val = document.getElementById("code").value;
	if (ssid_Val == "" || pw_Val == "" || zone_Val == ""){
		console.log("All fields must be filled out");
		alert("All fields must be filled out!")
		return false;
	}	
	var message = {
		"ssid":ssid_Val,
		"pw":pw_Val,
		"zone":zone_Val
	}
	console.log(message);
	webSocketConn.send(JSON.stringify(message));
	console.log(message);
}
function onError(evt) {
    console.log("ERROR: " + evt.data);
}

function onOpen(evt){
	getFormVal();
}
function onMessage(evt){
	var serverMsg = evt.data;
	console.log(serverMsg);
	document.getElementById('srvMsg').style.color = "blue";
	document.getElementById('srvMsg').innerHTML = serverMsg;
	
}
function frmReset(){
	document.getElementById("frmParams").reset();
}

function heartbeat(){
	if (!webSocketConn)return;
	if (webSocketConn.readyState !== 1)return;
	webSocketConn.send("heartbeat");
}

window.addEventListener("load", init, false);
</SCRIPT>
</head>
<body>
<h2>WiFi and API Parameters</h1>
<h3>Visit https:\\api.azanpro.com to obtain your Zone Code. It is case sensitive.</h2h2>
<p>Enter your WiFi Credentials and API Zone Code (e.g trg01 for Kuala Terengganu).</p>
<div style="overflow-x:auto;">
<form id = "frmParams" method="GET">
WiFi ssid:<input type="text" id="ssid" name = "fssid"><br>
WiFi Password: <input type="text" id="pass" name = "fpass"><br>
API Zone Code: <input type="text" id="code" name = "fzone"><br>
<input type="button" name="submBtn" value ="Submit" onClick = "getFormVal()">
<input type="button" name="clrBtn" value="Clear" onClick="frmReset()">
</form>
</div>
<p id ="srvMsg"></p>
</body>
</html>
